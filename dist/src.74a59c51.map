{"version":3,"sources":["src/index.js"],"names":["efineComponent","componentClazz","ElementTemplate","HTMLElement","vm","prototype","connectedCallback","documentFlagment","strToHtml","template","trim","registerDefineProperty","registerDom","appendChild","bindEvent","attrs","Object","keys","props","observedAttributes","attributeChangedCallback","apply","arguments","tagName","getTagNameByClazzName","name","customElements","define","clazzName","replace","match","toLowerCase","slice","str","document","createElement","innerHTML","content","eventListener","event","currentTarget","events","type","documentFragment","context","childNodes","forEach","node","attributes","i","startsWith","methodName","getAttribute","methods","call","addEventListener","length","strTemplateRegExp","nodeType","Node","TEXT_NODE","strTemplate","nodeValue","test","protoNameArr","data","refreshDom","resultStr","expression","join","evalFn","Function","watcher","push","protoName","defineProperty","set","newVal","register","callback","get","enumerable","configurable","obj"],"mappings":"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","file":"src.74a59c51.map","sourceRoot":"..","sourcesContent":["export const efineComponent = function (componentClazz) {\n    const ElementTemplate = class extends HTMLElement {}\n    const vm = new componentClazz();\n    ElementTemplate.prototype.connectedCallback = function() {\n        const documentFlagment = strToHtml(vm.template.trim());\n        registerDefineProperty(vm);\n        registerDom(documentFlagment, vm);\n        this.appendChild(documentFlagment);\n        bindEvent(this, vm);\n    }\n    const attrs = Object.keys(vm.props);\n    ElementTemplate.observedAttributes = attrs;\n    ElementTemplate.prototype.attributeChangedCallback = function() {\n        vm.attributeChangedCallback.apply(this, arguments);\n    }\n    const tagName = vm.tagName || getTagNameByClazzName(componentClazz.name);\n    customElements.define(tagName, ElementTemplate);\n};\n\nconst getTagNameByClazzName = function (clazzName) {\n    return clazzName\n            .replace(/[A-Z]/g, (match) => '-' + match.toLowerCase())\n            .slice(1);\n};\n\nconst strToHtml = function(str) {\n    const template = document.createElement('template');\n    template.innerHTML = str;\n    return template.content;\n};\n\nconst eventListener = event => event.currentTarget.events[event.type](event);\n\nconst bindEvent = function(documentFragment, context) {\n    documentFragment.childNodes.forEach((node) => {\n        if (!node.tagName) return ;\n        bindEvent(node, context);\n        const { attributes } = node;\n        for (let i = 0; i < attributes.length; i++) {\n            let { name } = attributes[i];\n            if (!name.startsWith('@')) continue;\n            const methodName = node.getAttribute(name);\n            name = name.slice(1);\n            if (!node.events) {\n                node.events = {};\n            }\n            node.events[name] = function (event) {\n                if (context.methods) context.methods[methodName].call(context, event);\n            };\n            node.addEventListener(name, eventListener);\n        }\n    });\n};\n\nconst strTemplateRegExp = /\\{\\{((?:.|\\n)+?)\\}\\}/g;\n\nconst registerDom = function(documentFragment, context) {\n    documentFragment.childNodes.forEach((node) => {\n        if (node.nodeType === Node.TEXT_NODE) {\n            const strTemplate = node.nodeValue;\n            if (!strTemplateRegExp.test(strTemplate)) return;\n            const protoNameArr = Object.keys(context.data);\n            const refreshDom = function () {\n                let resultStr = strTemplate;\n                resultStr.replace(strTemplateRegExp, function(match, expression) {\n                    const keys = protoNameArr.join(',');\n                    const evalFn = new Function(`{${keys}}`, `return ${expression}`);\n                    resultStr = resultStr.replace(match, evalFn(context.data));\n                });\n                if(node.nodeValue !== resultStr)\n                    node.nodeValue = resultStr;\n            };\n            refreshDom();\n            watcher.push(refreshDom);\n        }\n        registerDom(node, context);\n    });\n};\n\nconst watcher = [];\n\nconst registerDefineProperty = function(context) {\n    Object.keys(context.data()).forEach((protoName) => {\n        context.data['_' + protoName] = context.data()[protoName];\n        Object.defineProperty(context.data, protoName, {\n            set: function(newVal) {\n                if (context.data['_' + protoName] === newVal) return;\n                context.data['_' + protoName] = newVal;\n                // newVal is Object\n                if(newVal instanceof Object)\n                    register(newVal);\n                watcher.forEach((callback) => callback());\n\n            },\n            get: function() {\n                return context.data['_' + protoName];\n            },\n            enumerable: true,\n            configurable: true\n        });\n        if(context.data[protoName] instanceof Object)\n            register(context.data[protoName]);\n    });\n};\n\nconst register = function(obj) {\n    Object.keys(obj).forEach((protoName) => {\n        obj['_' + protoName] = obj[protoName];\n\n        Object.defineProperty(obj, protoName, {\n            set: function(newVal) {\n                if (obj['_' + protoName] === newVal) return;\n                obj['_' + protoName] = newVal;\n                watcher.forEach((callback) => callback());\n            },\n            get: function() {\n                return obj['_' + protoName];\n            },\n            enumerable: true,\n            configurable: true\n        });\n        if(obj[protoName] instanceof Object)\n            register(obj[protoName]);\n    });\n};"]}